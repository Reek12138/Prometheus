<launch>
	<!-- ========== STEP [1] 启动 Gazebo 仿真环境 ========== -->
	<!-- Gazebo configs -->
  <arg name="gui" default="true"/>
  <arg name="debug" default="false"/>
  <arg name="verbose" default="false"/>
  <arg name="paused" default="false"/>
  <arg name="respawn_gazebo" default="false"/>
	<arg name="world" default="$(find prometheus_gazebo)/worlds/prometheus_logo.world"/>
  <!-- Gazebo sim -->
  <include file="$(find gazebo_ros)/launch/empty_world.launch">
    <arg name="gui" value="$(arg gui)"/>
    <arg name="debug" value="$(arg debug)"/>
    <arg name="verbose" value="$(arg verbose)"/>
    <arg name="paused" value="$(arg paused)"/>
    <arg name="respawn_gazebo" value="$(arg respawn_gazebo)"/>
    <arg name="world_name" value="$(arg world)"/>
  </include>
  <!-- ========== ========== ========== -->

  <!-- ========== STEP [2] 参数设置 ========== -->
	<!-- 无人机集群数量 [需要手动设置] -->
	<arg name="swarm_num_uav" default="2"/>
	<arg name="uav1_id" default="1"/>
	<arg name="uav2_id" default="2"/>
	<arg name="uav3_id" default="3"/>
	<arg name="uav4_id" default="4"/>
	<!-- 无人机初始位置 [需要手动设置] -->
	<arg name="uav1_init_x" default="0.0"/>
  <arg name="uav1_init_y" default="0.0"/>
  <arg name="uav2_init_x" default="1.0"/>
  <arg name="uav2_init_y" default="1.0"/>
  <arg name="uav3_init_x" default="-0.5"/>
  <arg name="uav3_init_y" default="0.0"/>
  <arg name="uav4_init_x" default="-1.5"/>
  <arg name="uav4_init_y" default="0.0"/>
	<!-- swarm_estimator 参数 -->
	<arg name="input_source" default="2"/>
	<!-- swarm_controller 参数 -->
	<arg name="collision_flag" default="0"/>
	<arg name="Takeoff_height" default="1.0"/>
	<arg name="Disarm_height" default="0.2"/>
	<arg name="Land_speed" default="0.2"/>
	<arg name="Land_mode" default="1"/>
	<!-- 地理围栏 -->
	<arg name="x_min" default="-100.0"/>
	<arg name="x_max" default="100.0"/>
	<arg name="y_min" default="-100.0"/>
	<arg name="y_max" default="100.0"/>
	<arg name="z_min" default="-1.0"/>
	<arg name="z_max" default="50.0"/>
  <!-- ========== ========== ========== -->  

  <!-- ========== STEP [3] 启动仿真无人机 ========== -->
  <!-- 1号飞机 -->
  <group ns="/uav1">
    <arg name="id" value="$(arg uav1_id)"/>
    <arg name="x" value="$(arg uav1_init_x)"/>
    <arg name="y" value="$(arg uav1_init_y)"/>
    <arg name="sdf_path" value="$(find prometheus_gazebo)/amov_models/Multisolo/uav1/uav1.sdf"/>
    <!-- <arg name="sdf_path" value="$(find prometheus_gazebo)/amov_models/p450/p450.sdf"/> -->
    <arg name="model_name" value="uav1"/>

    <include file="$(find testpkg)/launch/env/sitl_swarm_single.launch">
      <arg name="swarm_num_uav" value="$(arg swarm_num_uav)"/>
      <arg name="uav_id" value="$(arg id)"/>
      <arg name="sdf" value="$(arg sdf_path)"/>
      <arg name="model" value="$(arg model_name)"/>
      <arg name="uav_init_x" value="$(arg x)"/>
      <arg name="uav_init_y" value="$(arg y)"/>
      <arg name="uav_init_z" value="0.15"/>
      <arg name="uav_init_yaw" value="0.0"/>
    </include>
    <!-- swarm_estimator -->
    <node pkg="prometheus_swarm_control" type="swarm_estimator" name="swarm_estimator" output="screen">
      <param name="uav_id" value="$(arg id)"/>
      <param name="input_source" value="$(arg input_source)" />
    </node>
    <!-- swarm_controller -->
    <node pkg="prometheus_swarm_control" type="swarm_controller" name="swarm_controller" output="screen">
      <param name="swarm_num_uav" value="$(arg swarm_num_uav)"/>
      <param name="uav_id" value="$(arg id)"/>
      <param name="collision_flag" value="$(arg collision_flag)"/>
      <param name="Takeoff_height" value="$(arg Takeoff_height)"/>
      <param name="Disarm_height" value="$(arg Disarm_height)"/>
      <param name="Land_speed" value="$(arg Land_speed)"/>
      <param name="Land_mode" value="$(arg Land_mode)"/>
      <param name="geo_fence/x_min" value="$(arg x_min)"/>
      <param name="geo_fence/x_max" value="$(arg x_max)"/>
      <param name="geo_fence/y_min" value="$(arg y_min)"/>
      <param name="geo_fence/y_max" value="$(arg y_max)"/>
      <param name="geo_fence/z_min" value="$(arg z_min)"/>
      <param name="geo_fence/z_max" value="$(arg z_max)"/>
    </node>
  </group>
  <!-- 2号飞机 -->
  <group ns="/uav2">
    <arg name="id" value="$(arg uav2_id)"/>
    <arg name="x" value="$(arg uav2_init_x)"/>
    <arg name="y" value="$(arg uav2_init_y)"/>
    <arg name="sdf_path" value="$(find prometheus_gazebo)/amov_models/Multisolo/uav2/uav2.sdf"/>
    <!-- <arg name="sdf_path" value="$(find prometheus_gazebo)/amov_models/p450/p450.sdf"/> -->
    <arg name="model_name" value="uav2"/>

    <include file="$(find testpkg)/launch/env/sitl_swarm_single.launch">
      <arg name="swarm_num_uav" value="$(arg swarm_num_uav)"/>
      <arg name="uav_id" value="$(arg id)"/>
      <arg name="sdf" value="$(arg sdf_path)"/>
      <arg name="model" value="$(arg model_name)"/>
      <arg name="uav_init_x" value="$(arg x)"/>
      <arg name="uav_init_y" value="$(arg y)"/>
      <arg name="uav_init_z" value="0.15"/>
      <arg name="uav_init_yaw" value="0.0"/>
    </include>
    <!-- swarm_estimator -->
    <node pkg="prometheus_swarm_control" type="swarm_estimator" name="swarm_estimator" output="screen">
      <param name="uav_id" value="$(arg id)"/>
      <param name="input_source" value="$(arg input_source)" />
    </node>
    <!-- swarm_controller -->
    <node pkg="prometheus_swarm_control" type="swarm_controller" name="swarm_controller" output="screen">
      <param name="swarm_num_uav" value="$(arg swarm_num_uav)"/>
      <param name="uav_id" value="$(arg id)"/>
      <param name="collision_flag" value="$(arg collision_flag)"/>
      <param name="Takeoff_height" value="$(arg Takeoff_height)"/>
      <param name="Disarm_height" value="$(arg Disarm_height)"/>
      <param name="Land_speed" value="$(arg Land_speed)"/>
      <param name="Land_mode" value="$(arg Land_mode)"/>
      <param name="geo_fence/x_min" value="$(arg x_min)"/>
      <param name="geo_fence/x_max" value="$(arg x_max)"/>
      <param name="geo_fence/y_min" value="$(arg y_min)"/>
      <param name="geo_fence/y_max" value="$(arg y_max)"/>
      <param name="geo_fence/z_min" value="$(arg z_min)"/>
      <param name="geo_fence/z_max" value="$(arg z_max)"/>
    </node>
  </group>
  <!-- ========== ========== ========== -->

  <!-- ========== STEP [4] 地面站节点 ========== -->
  <!-- ========== ========== ========== -->

  <!-- ========== STEP [5] 阵型控制节点 ========== -->
  <!-- ========== ========== ========== -->

  <!-- ========== STEP [6] rviz可视化 ========== -->
	<!-- 启动rviz,设为false可关闭 -->
	<arg name="visualization" default="true"/>
	<group if="$(arg visualization)">
    <node type="rviz" name="rviz" pkg="rviz" args="-d $(find testpkg)/config/rviz_config/formation.rviz" />
  </group>
  <!-- ========== ========== ========== -->

  <!-- ========== STEP [7] 集群管理节点 ========== -->
	<node pkg="testpkg" type="swarm_manager_node" name="swarm_manager_node">
		<param name="swarm_num" value="$(arg swarm_num_uav)"/>

		<param name="offset_x_2" value="0.0"/>
		<param name="offset_y_2" value="0.0"/>
		<param name="offset_z_2" value="0.0"/>
	</node>
	<!-- ========== ========== ========== -->


</launch>

