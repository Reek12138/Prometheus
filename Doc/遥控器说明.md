## 遥控器说明

在真实飞行过程中，我们使用真实的遥控器作为控制无人机的主要操作来源，遥控器始终拥有最高的权限，精湛的遥控器操作手法可以保证无人机安稳着陆，但对于很多非专业来说，遥控的操作技巧是需要不断的练习的。我们始终强调一个观念，仿真与实机结合，这样更加符合开发流程，在以往的仿真中，我们通过键盘控制无人机飞行，并不能真实的反应出实机飞行时该怎么操作，也是基于现在存在的种种问题，为了让仿真与实机结合的更加完美，在Prometheus中增加遥控器控制方式，与真机使用更加对应起来，更加容易上手进行二次开发。下图就是仿真中的摇杆控制的框架协作图

### 遥控器仿真驱动安装

```shell
## 安装遥控器仿真驱动
sudo apt-get install jstest-gtk
## 安装完成之后，可以在终端中运行如下指令确认遥控器是否正常以及摇杆和按钮的响应情况
jstest-gtk
```

### 遥控器数据流

#### 真实飞行下的遥控器数据流（without Prometheus）

遥控器 -> 接收机  -> PX4固件（哪个模块，发布了哪个uorb消息）

#### 真实飞行下的遥控器数据流（with Prometheus）

遥控器 -> 接收机  -> PX4固件（哪个模块，发布了哪个uorb消息）-> PX4 Mavlink模块 -> Mavros（哪个文件，发布了哪个话题）  -> Prometheus订阅/mavros/rc/in话题

- PX4中哪个模块，发布了哪个uorb消息？
- PX4 - mavlink_message.cpp 发送 xxx 消息？

- Mavros - rc_io.cpp 接收RC_CHANNELS or RC_CHANNELS_RAW 消息（？），发布话题/mavros/rc/in
- uav_controller.cpp 订阅话题 /mavros/rc/in  (处理程序在rc_input.h)

#### 仿真飞行下的遥控器数据流（with Prometheus）

遥控器 -> 遥控器驱动（joy_node.cpp） -> uav_controller.cpp

- joy_node.cpp 发布话题 agent_name + "/prometheus/fake_rc_in"
- uav_controller.cpp 订阅话题 agent_name + "/prometheus/fake_rc_in" (处理程序在rc_input.h)

### 遥控器通道和方向

| 遥控器 | 通道 | 含义                                                 |
| :--: | ------  | -----------------  |
| 右摇杆（左右） | 通道1 | 滚转（向左推，无人机向左移动） |
| 右摇杆（上下） | 通道2 | 俯仰（向上推，无人机向前飞）                         |
| 左摇杆（上下） | 通道3 | 油门（向上推，无人机向上飞）                         |
| 左摇杆（左右）  | 通道4 | 偏航（向左推，无人机向左转弯）                       |
| SWA（两段开关） | 通道5 | 解锁/上锁开关                                        |
| SWB（三段开关） | 通道6 | Prometheus控制模式切换，分别对应MANUAL-HOVER-COMMAND |
| SWC（三段开关） | 通道7 | KILL开关，也可以留作用户自定义                       |
| SWD（两段开关） | 通道8 | Prometheus中的LAND模式 |

