# P600实机飞行准备指南

[TOC]

### 硬件准备

- P600无人机本体+电池+GPS天线
- 遥控器+四节电池
- Homer+天线+电池+Homer电源线+百/千兆网线
- RTK+蘑菇头基站+电池+RTK电源线+RTK与基站连接线+Homer&RTK连接线

### 起飞预备设置

1. Homer和RTK连接
   1. RTK COM2 <-> Homer UART2
2. Homer网线连接到电脑
   1. 在电脑有线连接中配置IP，不要和无人机IP重复，可填`192.168.1.123`
   2. ==Homer多机串口配置？==
3. 打开遥控器，P600开机
   1. 遥控器SWC上到下分别表示 Altitude, Position, Land (可以在 QGC 里查看或修改)
   2. 遥控器SWD是切入/切出 Offboard
4. Ping飞机IP，等待连接后开启软件连接
   1. QGC
   2. NoMachine（不一定需要，可以用ssh）
   3. VSCode+ssh（初次配置需要保证电脑能连上互联网）
5. **关键检查**（失败的话尝试全部硬件断电重启）
   1. QGC检查卫星数量以及定位情况（需要是`3D RTK Lock (fixed)`或`3D RTK GPS (float)`）
   2. ==RTK闪灯颜色应为？==
6. 无人机定位数据纠偏
   1. QGC内打开`MAVLink Console`输入`ekf2 stop`（无人机有警报声正常）
   2. 再输入`ekf2 start`，等待完成提示消息，需要一到两分钟左右
   3. 查看`LOCAL_POSITION_NED`的数据，三轴位置都在0附近即可
7. **程序控制检查**
   1. （可选）电脑也加入ROS网络
      1. `.bashrc`
         1. `export ROS_MASTER_URI=http://192.168.1.xx4:11311`（其中xx4根据无人机机载电脑设置）
         2. `export ROS_HOSTNAME=192.168.1.123`（其中123根据有线连接电脑IP设置）
   2. 单机
      1. ROS脚本`exp_mavros_gimbal.launch`或`exp_mavros_lidar.launch`
      2. （可选）电脑内启动调试工具
         1. `rqt_graph`看节点图
         2. `rviz`可视化话题数据，检查一下无人机是否有定位
         3. `rqt_topic`检查所有话题
   3. 多机
      1. 每一台机上都启动`exp_swarm_single.launch`（记得设置好ID和集群数量参数）
      2. 在一台无人机或者电脑上启动`exp_swarm_manager.launch`
         1. 开启`rviz`可视化，订阅转换后的坐标系，进行手动调试
         2. 将主机移动到和坐标系原点重合（云台方向是机体坐标系x方向，无人机世界系朝向为ENU）
         3. 对于其他无人机，沿着主机x或y轴方向进行排布，然后在QGC里面重新进行位姿纠偏（`ekf2 stop`与`ekf2 start`）以重置**其他无人机的世界系原点位置**
      3. 重新启动其他无人机的`exp_swarm_single.launch`
      4. 根据实际摆放距离调整`exp_swarm_manager.launch`参数后重新启动
      5. 开`rviz`检查转换后坐标系是否直观上和摆放相同
